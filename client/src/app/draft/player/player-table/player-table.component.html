<mat-drawer-container class="container" autosize>
  <mat-drawer #drawer class="sidenav" mode="side" position="end">
    <div class="close-btn-ctr">
      <button mat-icon-button color="accent" (click)="drawer.close()" (click)="clearNote()">
        <mat-icon>clear</mat-icon>
      </button>
    </div>
    <app-create-note></app-create-note>
    <app-note [notesInput]="notes" [userIdInput]="currentUser" [isTableInput]="true" [loadingInput]="loading"></app-note>
  </mat-drawer>

  <div class="main-loading" *ngIf="loading">
    <loading-spinner></loading-spinner>
  </div>

  <div class='content' *ngIf="!loading">
    <div class="resetButtonContainer">
      <button mat-raised-button color="accent" class="resetButton" (click)="resetAll()"><i
          class="material-icons">undo</i>Reset All</button>
    </div>

    <mat-form-field>
      <input matInput (keyup)="applyFilter($event.target.value)" placeholder="Filter">
    </mat-form-field>

    <table mat-table [dataSource]="dataSource" multiTemplateDataRows class="mat-elevation-z8" matSort>
      <ng-container matColumnDef="draft">
        <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
        <td mat-cell *matCellDef="let player">
          <button mat-icon-button color="primary" (click)="toggleRow(player)">
            <mat-icon>{{ player.selected ? 'undo' : 'add' }}</mat-icon>
          </button>
        </td>
      </ng-container>

      <ng-container matColumnDef="note">
        <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
        <td mat-cell *matCellDef="let player">
          <button mat-icon-button color="primary" (click)="drawer.toggle()" (click)="addNoteClick()">
            <mat-icon>note_add</mat-icon>
          </button>
        </td>
      </ng-container>

      <ng-container matColumnDef="rank">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Rank </th>
        <td mat-cell *matCellDef="let player"> {{(player.defaultRank !== null) ? player.defaultRank.rank : 'NR'}} </td>
      </ng-container>

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Name </th>
        <td mat-cell *matCellDef="let player" class="bold-font"> {{ player.initialName }}
        </td>
      </ng-container>

      <ng-container matColumnDef="position">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> POS </th>
        <td mat-cell *matCellDef="let player"> {{player.position}} </td>
      </ng-container>

      <ng-container matColumnDef="team">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Team </th>
        <td mat-cell *matCellDef="let player"> {{player.team.abbreviation}} </td>
      </ng-container>

      <ng-container matColumnDef="bye">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Bye </th>
        <td mat-cell *matCellDef="let player"> {{player.team.stats.bye}} </td>
      </ng-container>

      <ng-container matColumnDef="completions">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> CMP </th>
        <td mat-cell *matCellDef="let player"> {{ (player.projection !== null) ? player.projection.completions : 0 }} </td>
      </ng-container>

      <ng-container matColumnDef="attempts">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> ATT </th>
        <td mat-cell *matCellDef="let player"> {{ (player.projection !== null) ? player.projection.attempts : 0 }} </td>
      </ng-container>

      <ng-container matColumnDef="passYards">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Pass YDS </th>
        <td mat-cell *matCellDef="let player"> {{ (player.projection !== null) ? player.projection.passYards : 0 }} </td>
      </ng-container>

      <ng-container matColumnDef="passTd">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Pass TD </th>
        <td mat-cell *matCellDef="let player"> {{ (player.projection !== null) ? player.projection.passTd : 0 }} </td>
      </ng-container>

      <ng-container matColumnDef="interception">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> INT </th>
        <td mat-cell *matCellDef="let player"> {{ (player.projection !== null) ? player.projection.interception : 0 }} </td>
      </ng-container>

      <ng-container matColumnDef="carries">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> CAR </th>
        <td mat-cell *matCellDef="let player"> {{ (player.projection !== null) ? player.projection.carries : 0 }} </td>
      </ng-container>

      <ng-container matColumnDef="rushYards">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Rush YDS </th>
        <td mat-cell *matCellDef="let player"> {{ (player.projection !== null) ? player.projection.rushYards : 0 }} </td>
      </ng-container>

      <ng-container matColumnDef="rushTd">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Rush TD </th>
        <td mat-cell *matCellDef="let player"> {{ (player.projection !== null) ? player.projection.rushTd : 0 }} </td>
      </ng-container>

      <ng-container matColumnDef="fumbles">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> FUM </th>
        <td mat-cell *matCellDef="let player"> {{ (player.projection !== null) ? player.projection.fumbles : 0 }} </td>
      </ng-container>

      <ng-container matColumnDef="receptions">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> REC </th>
        <td mat-cell *matCellDef="let player"> {{ (player.projection !== null) ? player.projection.receptions : 0 }} </td>
      </ng-container>

      <ng-container matColumnDef="receivingYards">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> REC YDS </th>
        <td mat-cell *matCellDef="let player"> {{ (player.projection !== null) ? player.projection.receivingYards : 0 }} </td>
      </ng-container>

      <ng-container matColumnDef="receivingTd">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> REC TD </th>
        <td mat-cell *matCellDef="let player"> {{ (player.projection !== null) ? player.projection.receivingTd : 0 }} </td>
      </ng-container>

      <ng-container matColumnDef="fantasyPoints">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Fantasy PTS </th>
        <td mat-cell *matCellDef="let player" class="bold-font"> {{ (player.projection !== null) ? player.projection.fantasyPoints : 0 }} </td>
      </ng-container>

      <ng-container matColumnDef="vbd">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> VBD </th>
        <td mat-cell *matCellDef="let player"> 0.0 </td>
      </ng-container>

      <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
      <ng-container matColumnDef="expandedDetail">
        <td mat-cell *matCellDef="let player" [attr.colspan]="columnsToDisplay.length">
          <div class="player-detail" [@detailExpand]="player == expandedPlayer ? 'expanded' : 'collapsed'">
            <div class="player-description">
              <span class="team-info-col team-logo">
                <div>
                  <div class="team-info-offense-rank" [ngClass]="{
                      'green-text': player.team.stats.rank <= 12,
                      'orange-text': player.team.stats.rank > 12 && player.team.stats.rank <= 20,
                      'red-text': player.team.stats.rank > 20
                    }">
                    <span class="label">Offense Rank: </span>{{player.team.stats.rank}}</div>
                </div>
              </span>
              <span class="team-info-col">
                <div class="team-info"><span class="label">Total Points: </span>{{player.team.stats.pointsFor}}</div>
                <div class="team-info"><span class="label">Total Yards: </span>{{player.team.stats.yards}}</div>
                <div class="team-info"><span class="label">Yards Per Play: </span>{{player.team.stats.yardsPerPlay}}
                </div>
                <div class="team-info" [ngClass]="{
                    'green-text': player.team.stats.offensiveLineRank <= 12,
                    'orange-text': player.team.stats.offensiveLineRank > 12 && player.team.stats.offensiveLineRank <= 20,
                    'red-text': player.team.stats.offensiveLineRank > 20
                  }">
                  <span class="label">Offensive Line Rank:
                  </span>{{player.team.stats.offensiveLineRank}}</div>
                <div class="team-info"><span class="label">Score Percentage:
                  </span>{{player.team.stats.scorePercentage}}
                </div>
                <div class="team-info"><span class="label">Turnover Percentage:
                  </span>{{player.team.stats.turnoverPercentage}}</div>
              </span>
              <span class="team-info-col">
                <div class="team-info" [ngClass]="{
                    'green-text': player.team.stats.passRank <= 12,
                    'orange-text': player.team.stats.passRank > 12 && player.team.stats.passRank <= 20,
                    'red-text': player.team.stats.passRank > 20
                  }">
                  <span class="label">Pass Rank: </span>{{player.team.stats.passRank}}</div>
                <div class="team-info"><span class="label">Team Pass Attempts:
                  </span>{{player.team.stats.passAttempts}}
                </div>
                <div class="team-info"><span class="label">Team Pass Completions:
                  </span>{{player.team.stats.passCompletions}}</div>
                <div class="team-info"><span class="label">Team Pass Yards: </span>{{player.team.stats.passYards}}
                </div>
                <div class="team-info"><span class="label">Team Pass TD: </span>{{player.team.stats.passTd}}</div>
                <div class="team-info"><span class="label">Net Yards Per Pass:
                  </span>{{player.team.stats.netYardsPerPass}}
                </div>
              </span>
              <span class="team-info-col">
                <div class="team-info" [ngClass]="{
                    'green-text': player.team.stats.rushRank <= 12,
                    'orange-text': player.team.stats.rushRank > 12 && player.team.stats.rushRank <= 20,
                    'red-text': player.team.stats.rushRank > 20
                  }">
                  <span class="label">Rush Rank: </span>{{player.team.stats.rushRank}}</div>
                <div class="team-info" [ngClass]="{
                    'green-text': player.team.stats.runningBackSoS <= 12,
                    'orange-text': player.team.stats.runningBackSoS > 12 && player.team.stats.runningBackSoS <= 20,
                    'red-text': player.team.stats.runningBackSoS > 20
                  }">
                  <span class="label">Running Back SoS: </span>{{player.team.stats.runningBackSoS}}
                </div>
                <div class="team-info"><span class="label">Team Rush Attempts: </span>{{player.team.stats.rushAttempt}}
                </div>
                <div class="team-info"><span class="label">Team Rush Yards: </span>{{player.team.stats.rushYards}}
                </div>
                <div class="team-info"><span class="label">Team Rush TD: </span>{{player.team.stats.rushTd}}</div>
                <div class="team-info"><span class="label">Yards Per Rush: </span>{{player.team.stats.yardsPerRush}}
                </div>
              </span>
            </div>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="columnsToDisplay; sticky: true"></tr>
      <tr mat-row *matRowDef="let player; columns: columnsToDisplay;" class="player-row"
        [class.expanded-row]="expandedPlayer === player" [ngClass]="{
            'isSelected': player.selected,
            'isQb': player.position === 'QB',
            'isRb': player.position === 'RB',
            'isWr': player.position === 'WR',
            'isTe': player.position === 'TE'
          }" (click)="onRowClick(player)" (dblclick)="onRowDoubleClick(player)"
        matTooltip="Double-click the row to expand team details">
      </tr>
      <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="detail-row"></tr>
    </table>

    <mat-paginator [pageSizeOptions]="[14, 28, 42, 100, 492]"></mat-paginator>
  </div>

</mat-drawer-container>
